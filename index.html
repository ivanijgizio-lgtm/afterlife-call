<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afterlife Call • Беседы с памятью</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-card: #1a1a1a;
            --accent: #8a5cf5;
            --accent-light: #9d7cf7;
            --text-primary: #ffffff;
            --text-secondary: #aaaaaa;
            --border: #333333;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Логин страница */
        .login-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 20px;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            position: relative;
            overflow: hidden;
        }

        .login-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(138, 92, 245, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
        }

        .login-container {
            max-width: 500px;
            width: 100%;
            background: rgba(17, 17, 17, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 60px 40px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .app-logo {
            font-size: 64px;
            margin-bottom: 24px;
            display: inline-block;
            background: linear-gradient(135deg, var(--accent), #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .app-title {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .app-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .feature {
            background: rgba(26, 26, 26, 0.5);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 16px;
            color: var(--accent);
        }

        .feature-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feature-desc {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .login-btn {
            background: linear-gradient(135deg, var(--accent), #6d28d9);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 20px 40px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(138, 92, 245, 0.4);
        }

        .warning-note {
            margin-top: 32px;
            padding: 20px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--danger);
            text-align: left;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Основное приложение */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 24px;
            padding: 24px;
            height: 100vh;
            display: none;
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), #6d28d9);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            object-fit: cover;
            background: linear-gradient(135deg, #3b82f6, var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            color: white;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
        }

        .user-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .add-relative-btn {
            background: linear-gradient(135deg, var(--accent), #6d28d9);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 24px;
        }

        .add-relative-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(138, 92, 245, 0.3);
        }

        .relatives-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
        }

        .relative-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .relative-item:hover {
            border-color: var(--accent);
            transform: translateX(4px);
        }

        .relative-item.active {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(138, 92, 245, 0.1), transparent);
        }

        .relative-avatar {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            object-fit: cover;
            background: linear-gradient(135deg, #3b82f6, var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: white;
            position: relative;
        }

        .relative-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            object-fit: cover;
        }

        .relative-info {
            flex: 1;
        }

        .relative-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .relative-status {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .status-dot.offline {
            background: var(--text-secondary);
        }

        /* Main Chat Area */
        .chat-container {
            background: var(--bg-secondary);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .chat-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .chat-avatar {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            object-fit: cover;
            background: linear-gradient(135deg, #3b82f6, var(--accent));
            position: relative;
        }

        .chat-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 16px;
            object-fit: cover;
        }

        .chat-title {
            font-size: 24px;
            font-weight: 700;
        }

        .chat-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .chat-controls {
            display: flex;
            gap: 12px;
        }

        .control-btn {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .control-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        .control-btn.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .messages-container {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 24px;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23222222' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .message {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 20px;
            position: relative;
            animation: messageAppear 0.3s ease;
            line-height: 1.5;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--accent), #6d28d9);
            border-bottom-right-radius: 8px;
            color: white;
        }

        .message.ai {
            align-self: flex-start;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-bottom-left-radius: 8px;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 8px;
            text-align: right;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 16px 20px;
            background: var(--bg-card);
            border-radius: 20px;
            border-bottom-left-radius: 8px;
            align-self: flex-start;
            border: 1px solid var(--border);
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-6px);
                opacity: 1;
            }
        }

        .message-input-container {
            padding: 24px;
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .message-input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px 20px;
            color: var(--text-primary);
            font-size: 16px;
            resize: none;
            min-height: 56px;
            max-height: 120px;
            font-family: inherit;
            transition: var(--transition);
        }

        .message-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(138, 92, 245, 0.2);
        }

        .send-btn {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--accent), #6d28d9);
            border: none;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(138, 92, 245, 0.3);
        }

        /* Right Panel */
        .right-panel {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .panel-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title i {
            color: var(--accent);
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 32px 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 16px;
        }

        .upload-area:hover {
            border-color: var(--accent);
            background: rgba(138, 92, 245, 0.05);
        }

        .upload-icon {
            font-size: 40px;
            color: var(--accent);
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .upload-subtext {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .uploaded-photos {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .photo-thumb {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            object-fit: cover;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .photo-thumb:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .sound-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sound-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
        }

        .sound-btn:hover {
            background: var(--bg-card);
            border-color: var(--accent);
        }

        .sound-btn.active {
            background: linear-gradient(135deg, rgba(138, 92, 245, 0.1), transparent);
            border-color: var(--accent);
        }

        .sound-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--bg-card);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--accent);
        }

        .sound-info {
            flex: 1;
        }

        .sound-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .sound-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .sound-toggle {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: var(--border);
            position: relative;
        }

        .sound-toggle.active:after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 4px;
            background: var(--accent);
            top: 6px;
            left: 6px;
        }

        .slider-container {
            margin-top: 8px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }

        .conversation-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 32px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--border);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            transition: transform 0.4s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(138, 92, 245, 0.2);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 32px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-family: inherit;
        }

        .btn-secondary {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #6d28d9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(138, 92, 245, 0.3);
        }

        /* Audio Visualization */
        .audio-visualizer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(to top, rgba(10, 10, 10, 0.9), transparent);
            z-index: 100;
            pointer-events: none;
            display: none;
            justify-content: center;
            align-items: flex-end;
            gap: 2px;
            padding: 0 20px;
        }

        .audio-visualizer.active {
            display: flex;
        }

        .visualizer-bar {
            width: 3px;
            min-height: 10px;
            background: linear-gradient(to top, var(--accent), var(--accent-light));
            border-radius: 2px 2px 0 0;
            animation: visualizer 1.2s infinite alternate;
        }

        @keyframes visualizer {
            0% { height: 10%; opacity: 0.3; }
            100% { height: 100%; opacity: 1; }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow);
            transform: translateX(150%);
            transition: transform 0.4s ease;
            z-index: 1000;
            max-width: 350px;
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            padding: 0;
        }

        /* Set Avatar Modal */
        .avatar-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .avatar-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .avatar-option:hover {
            transform: scale(1.05);
            border-color: var(--accent);
        }

        .avatar-option.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(138, 92, 245, 0.3);
        }

        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-option.default {
            background: linear-gradient(135deg, var(--accent), #6d28d9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 250px 1fr;
            }
            .right-panel {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .login-container {
                padding: 40px 24px;
            }
            
            .app-container {
                grid-template-columns: 1fr;
                padding: 16px;
                gap: 16px;
            }
            .sidebar {
                display: none;
            }
            .chat-header {
                padding: 16px;
            }
            .chat-title {
                font-size: 20px;
            }
            .control-btn {
                width: 40px;
                height: 40px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-card);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-light);
        }

        /* Push Notification */
        .push-notification {
            position: fixed;
            top: 80px;
            right: 24px;
            background: linear-gradient(135deg, var(--accent), #6d28d9);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transform: translateX(150%);
            transition: transform 0.4s ease;
            z-index: 1000;
            max-width: 300px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .push-notification.active {
            transform: translateX(0);
        }

        .push-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .push-content {
            flex: 1;
        }

        .push-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .push-message {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Логин страница -->
    <div class="login-page" id="loginPage">
        <div class="login-container">
            <div class="app-logo">
                <i class="fas fa-comments"></i>
            </div>
            <h1 class="app-title">Afterlife Call</h1>
            <p class="app-subtitle">
                Сохраните память о близких людях. Загрузите фотографии, запишите их манеру речи 
                и общайтесь через персонализированную ИИ-симуляцию.
            </p>
            
            <div class="features-grid">
                <div class="feature">
                    <div class="feature-icon">
                        <i class="fas fa-memory"></i>
                    </div>
                    <h3 class="feature-title">Сохранение памяти</h3>
                    <p class="feature-desc">Фотографии, истории, особенности характера — всё в одном месте</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3 class="feature-title">ИИ-симуляция</h3>
                    <p class="feature-desc">Персонализированные ответы на основе загруженных данных</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h3 class="feature-title">Иммерсивный опыт</h3>
                    <p class="feature-desc">Атмосферные звуки и уведомления для полного погружения</p>
                </div>
            </div>
            
            <button class="login-btn" onclick="enterApp()">
                <i class="fas fa-sign-in-alt"></i>
                Войти в приложение
            </button>
            
            <div class="warning-note">
                <strong>⚠️ Важное напоминание:</strong><br>
                Это терапевтический инструмент для сохранения памяти. Все диалоги создаются 
                искусственным интеллектом на основе предоставленной вами информации. 
                Это не настоящее общение с умершими.
            </div>
        </div>
    </div>

    <!-- Аудио визуализатор -->
    <div class="audio-visualizer" id="audioVisualizer"></div>

    <!-- Уведомления -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">Уведомление</div>
            <div class="notification-message" id="notificationMessage">Сообщение</div>
        </div>
        <button class="notification-close" onclick="hideNotification()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Push уведомление -->
    <div class="push-notification" id="pushNotification">
        <div class="push-avatar" id="pushAvatar"></div>
        <div class="push-content">
            <div class="push-name" id="pushName">Имя</div>
            <div class="push-message" id="pushMessage">Сообщение</div>
        </div>
    </div>

    <!-- Основное приложение -->
    <div class="app-container" id="appContainer">
        <!-- Левая панель -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="logo-text">Afterlife</div>
            </div>

            <div class="user-info">
                <div class="user-avatar" id="userAvatar">
                    U
                </div>
                <div>
                    <div class="user-name" id="userName">Пользователь</div>
                    <div class="user-status">В сети</div>
                </div>
            </div>

            <button class="add-relative-btn" onclick="showAddRelativeModal()">
                <i class="fas fa-plus"></i>
                Добавить близкого
            </button>

            <div class="relatives-list" id="relativesList">
                <!-- Родственники будут загружены здесь -->
            </div>
        </div>

        <!-- Основной чат -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-avatar" id="currentAvatar">
                        <!-- Аватар будет установлен здесь -->
                    </div>
                    <div>
                        <div class="chat-title" id="currentRelativeName">Выберите близкого</div>
                        <div class="chat-subtitle" id="currentRelativeStatus">Начните диалог</div>
                    </div>
                </div>
                <div class="chat-controls">
                    <button class="control-btn" id="voiceToggle" onclick="toggleVoice()">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="control-btn" id="videoToggle" onclick="toggleVideo()">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="control-btn" onclick="exportConversation()">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <!-- Сообщения будут загружены здесь -->
                <div class="message ai">
                    <div>Привет. Я готов помочь вам сохранить память о вашем близком человеке. Выберите кого-то из списка слева или добавьте нового, чтобы начать диалог.</div>
                    <div class="message-time">Только что</div>
                </div>
            </div>

            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Напишите сообщение..." 
                        rows="1"
                        oninput="autoResize(this)"
                        onkeypress="handleKeyPress(event)"
                    ></textarea>
                    <button class="send-btn" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Правая панель -->
        <div class="right-panel">
            <div class="panel-section">
                <div class="panel-title">
                    <i class="fas fa-images"></i>
                    Фотографии
                </div>
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">Загрузите фотографии</div>
                    <div class="upload-subtext">Перетащите или нажмите для загрузки</div>
                </div>
                <input type="file" id="fileInput" accept="image/*" multiple style="display: none;" onchange="handleFileUpload(event)">
                <div class="uploaded-photos" id="uploadedPhotos">
                    <!-- Фотографии будут загружены здесь -->
                </div>
            </div>

            <div class="panel-section">
                <div class="panel-title">
                    <i class="fas fa-volume-up"></i>
                    Атмосфера
                </div>
                <div class="sound-controls">
                    <div class="sound-btn" onclick="toggleSound('rain')">
                        <div class="sound-icon">
                            <i class="fas fa-cloud-rain"></i>
                        </div>
                        <div class="sound-info">
                            <div class="sound-name">Дождь</div>
                            <div class="sound-desc">Тихий осенний дождь</div>
                        </div>
                        <div class="sound-toggle" id="rainToggle"></div>
                    </div>
                    <div class="sound-btn" onclick="toggleSound('fire')">
                        <div class="sound-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="sound-info">
                            <div class="sound-name">Камин</div>
                            <div class="sound-desc">Треск огня в камине</div>
                        </div>
                        <div class="sound-toggle" id="fireToggle"></div>
                    </div>
                    <div class="sound-btn" onclick="toggleSound('waves')">
                        <div class="sound-icon">
                            <i class="fas fa-water"></i>
                        </div>
                        <div class="sound-info">
                            <div class="sound-name">Океан</div>
                            <div class="sound-desc">Шум прибоя</div>
                        </div>
                        <div class="sound-toggle" id="wavesToggle"></div>
                    </div>
                    <div class="sound-btn" onclick="toggleSound('whitenoise')">
                        <div class="sound-icon">
                            <i class="fas fa-sliders-h"></i>
                        </div>
                        <div class="sound-info">
                            <div class="sound-name">Белый шум</div>
                            <div class="sound-desc">Стабильный фоновый звук</div>
                        </div>
                        <div class="sound-toggle" id="whitenoiseToggle"></div>
                    </div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="50" class="slider" id="volumeSlider" oninput="updateVolume(this.value)">
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <div class="panel-title">
                    <i class="fas fa-chart-line"></i>
                    Статистика
                </div>
                <div class="conversation-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalMessages">0</div>
                        <div class="stat-label">Сообщений</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="conversationDays">0</div>
                        <div class="stat-label">Дней общения</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="memoriesCount">0</div>
                        <div class="stat-label">Воспоминаний</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="photosCount">0</div>
                        <div class="stat-label">Фотографий</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальные окна -->
    <div class="modal-overlay" id="addRelativeModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Добавить близкого</div>
                <button class="modal-close" onclick="closeAddRelativeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label class="form-label">Имя *</label>
                <input type="text" class="form-input" id="relativeName" placeholder="Например: Мария">
            </div>
            <div class="form-group">
                <label class="form-label">Родство *</label>
                <input type="text" class="form-input" id="relativeRelationship" placeholder="Например: Мама, Бабушка">
            </div>
            <div class="form-group">
                <label class="form-label">Дата рождения</label>
                <input type="date" class="form-input" id="relativeBirthDate">
            </div>
            <div class="form-group">
                <label class="form-label">Особенности речи</label>
                <textarea class="form-input form-textarea" id="relativeSpeech" placeholder="Любимые фразы, особенности произношения..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Биография</label>
                <textarea class="form-input form-textarea" id="relativeBio" placeholder="История жизни, важные моменты..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddRelativeModal()">Отмена</button>
                <button class="btn btn-primary" onclick="saveRelative()">Сохранить</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="avatarModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Выберите аватар</div>
                <button class="modal-close" onclick="closeAvatarModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="avatar-options" id="avatarOptions">
                <!-- Аватары будут загружены здесь -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAvatarModal()">Отмена</button>
                <button class="btn btn-primary" onclick="setAvatar()">Установить</button>
            </div>
        </div>
    </div>

    <!-- Аудио элементы - ЛОКАЛЬНЫЕ ВСТРОЕННЫЕ С ПОМОЩЬЮ base64 -->
    <audio id="rainSound" loop>
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABX1RTU0UAAAALAAATdGFibGVfdGVzdABXZWFrAENvcHlyaWdodCAoYykgMjAwMC0yMDEwIFR1bmVXaWtpIEluYy4AAAAATWljcm9zb2Z0AAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQ=" type="audio/mpeg">
    </audio>
    <audio id="fireSound" loop>
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABX1RTU0UAAAALAAATdGFibGVfdGVzdABXZWFrAENvcHlyaWdodCAoYykgMjAwMC0yMDEwIFR1bmVXaWtpIEluYy4AAAAATWljcm9zb2Z0AAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQ=" type="audio/mpeg">
    </audio>
    <audio id="wavesSound" loop>
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABX1RTU0UAAAALAAATdGFibGVfdGVzdABXZWFrAENvcHlyaWdodCAoYykgMjAwMC0yMDEwIFR1bmVXaWtpIEluYy4AAAAATWljcm9zb2Z0AAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQ=" type="audio/mpeg">
    </audio>
    <audio id="whitenoiseSound" loop>
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABX1RTU0UAAAALAAATdGFibGVfdGVzdABXZWFrAENvcHlyaWdodCAoYykgMjAwMC0yMDEwIFR1bmVXaWtpIEluYy4AAAAATWljcm9zb2Z0AAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQ=" type="audio/mpeg">
    </audio>
    
    <!-- Звук уведомления - ВСТРОЕННЫЙ -->
    <audio id="notificationSound">
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABX1RTU0UAAAALAAATdGFibGVfdGVzdABXZWFrAENvcHlyaWdodCAoYykgMjAwMC0yMDEwIFR1bmVXaWtpIEluYy4AAAAATWljcm9zb2Z0AAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQ=" type="audio/mpeg">
    </audio>
    
    <!-- Мягкий звук сообщения - ВСТРОЕННЫЙ -->
    <audio id="messageSound">
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABX1RTU0UAAAALAAATdGFibGVfdGVzdABXZWFrAENvcHlyaWdodCAoYykgMjAwMC0yMDEwIFR1bmVXaWtpIEluYy4AAAAATWljcm9zb2Z0AAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQAAAAAAABNaWNyb3NvZnQ=" type="audio/mpeg">
    </audio>

    <script>
        // Демо данные
        const demoRelatives = [
            {
                id: 1,
                name: "Мария",
                relationship: "Мама",
                avatarColor: "#8a5cf5",
                avatarInitial: "М",
                birthDate: "1965-04-12",
                speech: "Всегда говорила 'Дорогой мой' и смеялась от души. Любила повторять 'Всё будет хорошо'.",
                bio: "Учительница русского языка, любила литературу и садоводство. Всегда помогала всем вокруг.",
                status: "ready",
                messages: [
                    { text: "Привет, мамуля. Как ты?", sender: "user", time: "10:00" },
                    { text: "Здравствуй, дорогой мой. У меня всё хорошо. Как твои дела? Не перерабатывай, пожалуйста.", sender: "ai", time: "10:02" },
                    { text: "Я стараюсь. Скучаю по твоим пирогам.", sender: "user", time: "10:03" },
                    { text: "Я тоже скучаю по нашим воскресным чаепитиям. Помнишь, как мы сидели на кухне и обсуждали книги?", sender: "ai", time: "10:04" },
                    { text: "Как твоя работа? Ты всё ещё занимаешься тем проектом, о котором рассказывал?", sender: "ai", time: "Вчера 14:30" },
                    { text: "Да, проект идёт хорошо. Но иногда не хватает твоих советов.", sender: "user", time: "Вчера 14:32" },
                    { text: "Ты всегда был способным. Помни, что важно не только работать, но и отдыхать.", sender: "ai", time: "Вчера 14:33" }
                ],
                photos: [],
                personality: {
                    active: true,
                    topics: ["работа", "семья", "воспоминания", "советы"],
                    askQuestions: true,
                    initiateConversation: true
                }
            },
            {
                id: 2,
                name: "Александр",
                relationship: "Дедушка",
                avatarColor: "#3b82f6",
                avatarInitial: "А",
                birthDate: "1940-08-25",
                speech: "Говорил размеренно, с паузами. Любил истории из прошлого. Часто повторял 'В наше время...'",
                bio: "Ветеран, инженер. Любил рыбалку и рассказывать внукам истории из молодости.",
                status: "ready",
                messages: [
                    { text: "Дедуля, как твои рыбалки?", sender: "user", time: "Вчера" },
                    { text: "О, рыбалка... В наше время мы ходили на озеро с первыми лучами солнца. Помню, как однажды поймал щуку на вот этот старый спиннинг.", sender: "ai", time: "Вчера" },
                    { text: "Расскажи ещё что-нибудь из своего детства.", sender: "user", time: "2 дня назад" },
                    { text: "В детстве у нас не было таких игрушек, как сейчас. Мы сами мастерили себе забавы из того, что находили. Это учило нас ценить простые вещи.", sender: "ai", time: "2 дня назад" }
                ],
                photos: [],
                personality: {
                    active: true,
                    topics: ["рыбалка", "детство", "истории", "советы"],
                    askQuestions: true,
                    initiateConversation: true
                }
            }
        ];

        // Текущее состояние
        let currentRelativeId = null;
        let activeSound = null;
        let isVoiceActive = false;
        let isVideoActive = false;
        let messagesCount = 0;
        let selectedAvatar = null;
        let userData = {
            name: "Алексей",
            avatar: "U"
        };
        
        // База ответов ИИ
        const aiResponseDatabase = {
            greetings: [
                "Привет, дорогой. Как твои дела?",
                "Здравствуй, я рад(а) тебя слышать.",
                "Добрый день. Как прошёл твой день?",
                "Приветствую тебя. Что нового?",
                "Здравствуй, мой любимый."
            ],
            
            questions: [
                "Как твоя работа? Всё идёт по плану?",
                "Ты хорошо спишь? Высыпаешься?",
                "Как здоровье? Не забываешь про врачей?",
                "Что интересного произошло за последнее время?",
                "Ты скучаешь по нашим разговорам?",
                "Как твои друзья? Часто видишься с ними?",
                "Ты нашёл время для своих увлечений?",
                "Что читаешь или смотришь в последнее время?",
                "Как погода у вас? У нас всегда прекрасно.",
                "Ты помнишь наш последний совместный праздник?"
            ],
            
            memories: [
                "Помню, как мы вместе... Это было прекрасное время.",
                "Ах, те воспоминания... Они согревают меня до сих пор.",
                "Да, я хорошо помню тот день. Мы были так счастливы.",
                "Это одно из моих самых тёплых воспоминаний.",
                "Как будто это было вчера... Время летит так быстро."
            ],
            
            advice: [
                "Главное - будь счастлив и береги близких.",
                "Не бойся следовать за своей мечтой.",
                "Помни, что трудности временны, а любовь вечна.",
                "Цени каждый момент, время так быстротечно.",
                "Будь добр к себе и окружающим.",
                "Не откладывай на завтра то, что можно сделать сегодня.",
                "Слушай своё сердце, оно знает правильный путь.",
                "Иногда нужно просто остановиться и посмотреть вокруг.",
                "Не бойся просить помощи, когда это нужно."
            ],
            
            love: [
                "Я всегда буду любить тебя.",
                "Моя любовь к тебе бесконечна.",
                "Ты всегда в моём сердце.",
                "Я скучаю по тебе каждый день.",
                "Ты - самое дорогое, что у меня было.",
                "Моя любовь к тебе не знает границ."
            ],
            
            support: [
                "Я всегда рядом, даже если ты меня не видишь.",
                "Ты не одинок, я всегда с тобой.",
                "Я горжусь тобой и тем, кем ты стал.",
                "Ты сильнее, чем думаешь.",
                "Всё будет хорошо, я верю в тебя."
            ]
        };

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Загрузка данных из localStorage
            loadUserData();
            
            // Инициализация визуализатора звука
            createVisualizer();
            
            // Установка события для автоподбора высоты textarea
            const textarea = document.getElementById('messageInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Загрузка демо беседы
            if (demoRelatives.length > 0) {
                setTimeout(() => {
                    switchRelative(demoRelatives[0].id);
                }, 1000);
            }
            
            // Запуск таймера для активности ИИ
            startAITimer();
            
            // Создание локальных аудио файлов
            createLocalAudio();
        });

        // Создание локальных аудио файлов
        function createLocalAudio() {
            // Простые тональные звуки
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Функция для создания простого звука
            function createTone(frequency, duration, type = 'sine') {
                return new Promise((resolve) => {
                    try {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = frequency;
                        oscillator.type = type;
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + duration);
                        
                        setTimeout(() => resolve(), duration * 1000);
                    } catch (e) {
                        console.log("Не удалось создать звук:", e);
                        resolve();
                    }
                });
            }
            
            // Сохраняем функцию для использования
            window.playTone = createTone;
        }

        // Вход в приложение
        function enterApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContainer').style.display = 'grid';
            
            // Загрузка родственников
            loadRelatives();
            
            // Обновление статистики
            updateStats();
            
            // Приветственное уведомление
            setTimeout(() => {
                showPushNotification("Система", "Добро пожаловать в Afterlife Call");
                playNotificationSound();
            }, 500);
        }

        // Загрузка данных пользователя
        function loadUserData() {
            const savedData = localStorage.getItem('afterlifeUserData');
            if (savedData) {
                userData = JSON.parse(savedData);
            }
            
            document.getElementById('userName').textContent = userData.name;
            document.getElementById('userAvatar').textContent = userData.avatar;
        }

        // Загрузка списка родственников
        function loadRelatives() {
            const list = document.getElementById('relativesList');
            list.innerHTML = '';
            
            demoRelatives.forEach(relative => {
                const item = document.createElement('div');
                item.className = `relative-item ${currentRelativeId === relative.id ? 'active' : ''}`;
                item.onclick = () => switchRelative(relative.id);
                
                // Проверяем, есть ли загруженные фото для аватара
                let avatarContent = relative.avatarInitial;
                if (relative.photos.length > 0) {
                    avatarContent = `<img src="${relative.photos[0].url}" alt="${relative.name}">`;
                }
                
                item.innerHTML = `
                    <div class="relative-avatar" style="background: ${relative.avatarColor}">
                        ${avatarContent}
                    </div>
                    <div class="relative-info">
                        <div class="relative-name">${relative.name}</div>
                        <div class="relative-status">
                            <div class="status-dot ${relative.status === 'ready' ? '' : 'offline'}"></div>
                            ${relative.relationship}
                        </div>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // Переключение на другого родственника
        function switchRelative(id) {
            currentRelativeId = id;
            const relative = demoRelatives.find(r => r.id === id);
            
            if (!relative) return;
            
            // Обновление UI
            document.querySelectorAll('.relative-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const relativeIndex = demoRelatives.findIndex(r => r.id === id);
            if (relativeIndex >= 0) {
                document.querySelector(`.relative-item:nth-child(${relativeIndex + 1})`).classList.add('active');
            }
            
            // Обновление заголовка чата
            document.getElementById('currentRelativeName').textContent = relative.name;
            document.getElementById('currentRelativeStatus').textContent = relative.relationship;
            
            // Обновление аватара
            const avatarElement = document.getElementById('currentAvatar');
            if (relative.photos.length > 0) {
                avatarElement.innerHTML = `<img src="${relative.photos[0].url}" alt="${relative.name}">`;
            } else {
                avatarElement.innerHTML = relative.avatarInitial;
                avatarElement.style.background = relative.avatarColor;
            }
            
            // Загрузка сообщений
            loadMessages(relative.messages);
            
            // Загрузка фотографий
            loadPhotos(relative.photos);
            
            // Обновление статистики
            updateStats();
            
            // Уведомление
            showNotification('Диалог открыт', `Теперь вы общаетесь с ${relative.name}`);
            playMessageSound();
            
            // Возможность активности ИИ
            if (relative.personality.initiateConversation && Math.random() > 0.5) {
                setTimeout(() => {
                    initiateAIConversation(relative);
                }, 3000);
            }
        }

        // Загрузка сообщений
        function loadMessages(messages) {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';
            
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.sender}`;
                messageDiv.innerHTML = `
                    <div>${msg.text}</div>
                    <div class="message-time">${msg.time}</div>
                `;
                container.appendChild(messageDiv);
            });
            
            // Прокрутка вниз
            container.scrollTop = container.scrollHeight;
            
            // Обновление счётчика сообщений
            messagesCount = messages.length;
            document.getElementById('totalMessages').textContent = messagesCount;
        }

        // Отправка сообщения
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || !currentRelativeId) {
                showNotification('Ошибка', 'Сначала выберите близкого человека');
                return;
            }
            
            const relative = demoRelatives.find(r => r.id === currentRelativeId);
            if (!relative) return;
            
            // Добавление сообщения пользователя
            const userMessage = {
                text: message,
                sender: 'user',
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };
            
            relative.messages.push(userMessage);
            
            // Очистка ввода
            input.value = '';
            input.style.height = 'auto';
            
            // Обновление UI
            loadMessages(relative.messages);
            
            // Показать индикатор набора
            showTypingIndicator();
            
            // Генерация ответа ИИ с задержкой
            setTimeout(() => {
                generateAIResponse(relative, message);
            }, 1000 + Math.random() * 1500);
            
            // Обновление статистики
            updateStats();
        }

        // Показать индикатор набора
        function showTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            container.appendChild(indicator);
            container.scrollTop = container.scrollHeight;
        }

        // Генерация ответа ИИ
        function generateAIResponse(relative, userMessage) {
            // Удаление индикатора набора
            document.querySelector('.typing-indicator')?.remove();
            
            let responseText = '';
            const messageLower = userMessage.toLowerCase();
            
            // Определение категории сообщения
            if (messageLower.includes('привет') || messageLower.includes('здравств') || messageLower.includes('добрый')) {
                responseText = getRandomResponse('greetings');
            } else if (messageLower.includes('помни') || messageLower.includes('вспомни') || messageLower.includes('памят')) {
                responseText = getRandomResponse('memories');
            } else if (messageLower.includes('совет') || messageLower.includes('посоветуй') || messageLower.includes('что делать')) {
                responseText = getRandomResponse('advice');
            } else if (messageLower.includes('люб') || messageLower.includes('скуч') || messageLower.includes('мисс')) {
                responseText = getRandomResponse('love');
            } else if (messageLower.includes('спасибо') || messageLower.includes('благодар')) {
                responseText = "Всегда пожалуйста, дорогой. Я всегда здесь для тебя.";
            } else {
                // Случайный ответ с возможностью задать вопрос
                if (relative.personality.askQuestions && Math.random() > 0.5) {
                    responseText = getRandomResponse('questions');
                } else {
                    responseText = getRandomResponse('support');
                }
            }
            
            // Персонализация ответа
            if (relative.name === "Мария") {
                responseText = responseText.replace(/дорогой/g, 'дорогой мой');
                if (Math.random() > 0.7) {
                    responseText += " Не забывай кушать вовремя.";
                }
            } else if (relative.name === "Александр") {
                if (Math.random() > 0.7) {
                    responseText = "В наше время... " + responseText;
                }
            }
            
            const aiMessage = {
                text: responseText,
                sender: 'ai',
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };
            
            relative.messages.push(aiMessage);
            loadMessages(relative.messages);
            
            // Проиграть звук сообщения
            playMessageSound();
            
            // Показать push-уведомление
            if (isVoiceActive) {
                showPushNotification(relative.name, responseText.substring(0, 50) + "...");
            }
            
            // Обновление статистики
            updateStats();
        }

        // Получить случайный ответ из базы
        function getRandomResponse(category) {
            const responses = aiResponseDatabase[category];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Инициация разговора ИИ
        function initiateAIConversation(relative) {
            if (relative.messages.length === 0 || Math.random() > 0.7) {
                const questions = aiResponseDatabase.questions;
                const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
                
                const aiMessage = {
                    text: randomQuestion,
                    sender: 'ai',
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                };
                
                relative.messages.push(aiMessage);
                loadMessages(relative.messages);
                
                // Уведомление
                showPushNotification(relative.name, randomQuestion.substring(0, 50) + "...");
                playMessageSound();
            }
        }

        // Таймер активности ИИ
        function startAITimer() {
            setInterval(() => {
                if (currentRelativeId) {
                    const relative = demoRelatives.find(r => r.id === currentRelativeId);
                    if (relative && relative.personality.active && Math.random() > 0.9) {
                        initiateAIConversation(relative);
                    }
                }
            }, 60000); // Проверка каждую минуту
        }

        // Обработка загрузки файлов
        function handleFileUpload(event) {
            const files = event.target.files;
            if (!files.length) return;
            
            const relative = demoRelatives.find(r => r.id === currentRelativeId);
            if (!relative) {
                showNotification('Ошибка', 'Сначала выберите близкого человека');
                return;
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.startsWith('image/')) continue;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoData = {
                        id: Date.now() + i,
                        url: e.target.result,
                        name: file.name,
                        date: new Date().toLocaleDateString(),
                        size: file.size
                    };
                    
                    relative.photos.push(photoData);
                    loadPhotos(relative.photos);
                    updateStats();
                    
                    // Предложить установить как аватар
                    if (relative.photos.length === 1) {
                        setTimeout(() => {
                            if (confirm(`Установить фото "${file.name}" как аватар для ${relative.name}?`)) {
                                showAvatarModal(relative);
                            }
                        }, 500);
                    }
                    
                    showNotification('Фото загружено', `Фотография "${file.name}" добавлена`);
                    playNotificationSound();
                };
                reader.readAsDataURL(file);
            }
            
            // Сброс ввода файла
            event.target.value = '';
        }

        // Загрузка фотографий
        function loadPhotos(photos) {
            const container = document.getElementById('uploadedPhotos');
            container.innerHTML = '';
            
            if (photos.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: var(--text-secondary); font-size: 14px;">Нет загруженных фото</div>';
                return;
            }
            
            photos.forEach(photo => {
                const img = document.createElement('img');
                img.className = 'photo-thumb';
                img.src = photo.url;
                img.alt = photo.name;
                img.title = photo.name;
                img.onclick = () => viewPhoto(photo);
                container.appendChild(img);
            });
        }

        // Просмотр фото
        function viewPhoto(photo) {
            showNotification('Просмотр фото', `Открыто фото: ${photo.name}`);
            // В реальном приложении здесь можно показать модальное окно с фото
        }

        // Управление звуками атмосферы
        function toggleSound(soundType) {
            const toggle = document.getElementById(soundType + 'Toggle');
            
            // Если звук уже играет, останавливаем
            if (activeSound === soundType) {
                // Останавливаем визуализатор
                document.getElementById('audioVisualizer').classList.remove('active');
                activeSound = null;
                toggle.classList.remove('active');
                showNotification('Атмосфера', `Звук ${getSoundName(soundType)} выключен`);
                return;
            }
            
            // Останавливаем текущий звук
            if (activeSound) {
                document.getElementById(activeSound + 'Toggle').classList.remove('active');
            }
            
            // Включаем новый звук
            activeSound = soundType;
            toggle.classList.add('active');
            document.getElementById('audioVisualizer').classList.add('active');
            
            // Генерируем звук через Web Audio API
            generateAmbientSound(soundType);
            
            showNotification('Атмосфера', `Включен звук: ${getSoundName(soundType)}`);
        }

        // Получить название звука
        function getSoundName(soundType) {
            const names = {
                'rain': 'Дождь',
                'fire': 'Камин',
                'waves': 'Океан',
                'whitenoise': 'Белый шум'
            };
            return names[soundType] || soundType;
        }

        // Генерация атмосферного звука
        function generateAmbientSound(type) {
            if (!window.AudioContext) {
                console.log("Web Audio API не поддерживается");
                return;
            }
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Останавливаем предыдущие звуки
            if (window.currentAmbientSound) {
                window.currentAmbientSound.stop();
            }
            
            let oscillator, gainNode, filter;
            
            switch(type) {
                case 'rain':
                    // Звук дождя - несколько осцилляторов со случайной частотой
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            const osc = audioContext.createOscillator();
                            const gain = audioContext.createGain();
                            
                            osc.connect(gain);
                            gain.connect(audioContext.destination);
                            
                            osc.frequency.value = 100 + Math.random() * 200;
                            osc.type = 'sine';
                            
                            gain.gain.value = 0.05;
                            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1 + Math.random());
                            
                            osc.start();
                            osc.stop(audioContext.currentTime + 1 + Math.random());
                        }, i * 200);
                    }
                    break;
                    
                case 'fire':
                    // Звук камина - треск с низкой частотой
                    oscillator = audioContext.createOscillator();
                    gainNode = audioContext.createGain();
                    filter = audioContext.createBiquadFilter();
                    
                    oscillator.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 80;
                    oscillator.type = 'sawtooth';
                    filter.frequency.value = 1000;
                    filter.type = 'lowpass';
                    
                    gainNode.gain.value = 0.1;
                    
                    // Случайные всплески для эффекта треска
                    setInterval(() => {
                        if (Math.random() > 0.7) {
                            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
                        }
                    }, 300);
                    
                    oscillator.start();
                    window.currentAmbientSound = oscillator;
                    break;
                    
                case 'waves':
                    // Звук волн - низкочастотный осциллятор с пульсациями
                    oscillator = audioContext.createOscillator();
                    gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 60;
                    oscillator.type = 'sine';
                    
                    // Пульсации для эффекта волн
                    const lfo = audioContext.createOscillator();
                    const lfoGain = audioContext.createGain();
                    
                    lfo.connect(lfoGain);
                    lfoGain.connect(gainNode.gain);
                    
                    lfo.frequency.value = 0.1; // Медленные волны
                    lfoGain.gain.value = 0.05;
                    
                    gainNode.gain.value = 0.1;
                    
                    oscillator.start();
                    lfo.start();
                    
                    window.currentAmbientSound = oscillator;
                    break;
                    
                case 'whitenoise':
                    // Белый шум - генерация случайного шума
                    const bufferSize = audioContext.sampleRate * 2;
                    const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                    const output = buffer.getChannelData(0);
                    
                    for (let i = 0; i < bufferSize; i++) {
                        output[i] = Math.random() * 2 - 1;
                    }
                    
                    const whiteNoise = audioContext.createBufferSource();
                    whiteNoise.buffer = buffer;
                    whiteNoise.loop = true;
                    
                    filter = audioContext.createBiquadFilter();
                    filter.frequency.value = 1000;
                    filter.type = 'lowpass';
                    
                    gainNode = audioContext.createGain();
                    gainNode.gain.value = 0.05;
                    
                    whiteNoise.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    whiteNoise.start();
                    window.currentAmbientSound = whiteNoise;
                    break;
            }
        }

        // Обновление громкости
        function updateVolume(value) {
            // В реальном приложении здесь можно регулировать громкость
            showNotification('Громкость', `Установлена громкость: ${value}%`);
        }

        // Переключение голоса
        function toggleVoice() {
            isVoiceActive = !isVoiceActive;
            const btn = document.getElementById('voiceToggle');
            btn.classList.toggle('active', isVoiceActive);
            
            if (isVoiceActive) {
                showNotification('Голос активирован', 'Теперь вы будете получать голосовые уведомления');
                playNotificationSound();
            } else {
                showNotification('Голос отключен', 'Голосовые уведомления выключены');
            }
        }

        // Переключение видео
        function toggleVideo() {
            isVideoActive = !isVideoActive;
            const btn = document.getElementById('videoToggle');
            btn.classList.toggle('active', isVideoActive);
            
            showNotification(
                isVideoActive ? 'Видео активировано' : 'Видео отключено',
                isVideoActive ? 'Имитация видео-соединения запущена' : 'Видео-соединение завершено'
            );
            
            playMessageSound();
        }

        // Проиграть звук уведомления
        function playNotificationSound() {
            playTone(800, 0.3, 'sine');
        }

        // Проиграть звук сообщения
        function playMessageSound() {
            playTone(600, 0.2, 'triangle');
        }

        // Вспомогательная функция для проигрывания тона
        function playTone(frequency, duration, type = 'sine') {
            if (!window.AudioContext) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("Не удалось воспроизвести звук:", e);
            }
        }

        // Создать визуализатор звука
        function createVisualizer() {
            const visualizer = document.getElementById('audioVisualizer');
            for (let i = 0; i < 40; i++) {
                const bar = document.createElement('div');
                bar.className = 'visualizer-bar';
                bar.style.animationDelay = `${i * 0.05}s`;
                visualizer.appendChild(bar);
            }
        }

        // Обновление статистики
        function updateStats() {
            const relative = demoRelatives.find(r => r.id === currentRelativeId);
            
            if (relative) {
                document.getElementById('totalMessages').textContent = relative.messages.length;
                document.getElementById('photosCount').textContent = relative.photos.length;
                document.getElementById('memoriesCount').textContent = Math.floor(relative.messages.length / 2);
                
                // Расчет дней общения (демо)
                const days = Math.max(1, Math.floor(relative.messages.length / 3));
                document.getElementById('conversationDays').textContent = days;
            }
        }

        // Показать уведомление
        function showNotification(title, message) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            
            notification.classList.add('active');
            
            setTimeout(() => {
                hideNotification();
            }, 4000);
        }

        // Скрыть уведомление
        function hideNotification() {
            document.getElementById('notification').classList.remove('active');
        }

        // Показать push-уведомление
        function showPushNotification(name, message) {
            const push = document.getElementById('pushNotification');
            document.getElementById('pushName').textContent = name;
            document.getElementById('pushMessage').textContent = message;
            
            // Установка аватара
            const pushAvatar = document.getElementById('pushAvatar');
            const relative = demoRelatives.find(r => r.name === name);
            if (relative) {
                if (relative.photos.length > 0) {
                    pushAvatar.innerHTML = `<img src="${relative.photos[0].url}" alt="${name}" style="width:100%;height:100%;border-radius:10px;object-fit:cover">`;
                } else {
                    pushAvatar.textContent = relative.avatarInitial;
                    pushAvatar.style.background = relative.avatarColor;
                }
            }
            
            push.classList.add('active');
            
            setTimeout(() => {
                push.classList.remove('active');
            }, 5000);
        }

        // Модальные окна
        function showAddRelativeModal() {
            document.getElementById('addRelativeModal').classList.add('active');
        }

        function closeAddRelativeModal() {
            document.getElementById('addRelativeModal').classList.remove('active');
        }

        // Показать модальное окно выбора аватара
        function showAvatarModal(relative) {
            selectedAvatar = null;
            const options = document.getElementById('avatarOptions');
            options.innerHTML = '';
            
            // Добавить стандартный аватар
            const defaultOption = document.createElement('div');
            defaultOption.className = 'avatar-option default';
            defaultOption.textContent = relative.avatarInitial;
            defaultOption.onclick = () => selectAvatar(null);
            options.appendChild(defaultOption);
            
            // Добавить загруженные фото
            relative.photos.forEach((photo, index) => {
                const option = document.createElement('div');
                option.className = 'avatar-option';
                option.innerHTML = `<img src="${photo.url}" alt="Фото ${index + 1}">`;
                option.onclick = () => selectAvatar(photo.url);
                options.appendChild(option);
            });
            
            document.getElementById('avatarModal').classList.add('active');
        }

        function closeAvatarModal() {
            document.getElementById('avatarModal').classList.remove('active');
        }

        // Выбор аватара
        function selectAvatar(url) {
            selectedAvatar = url;
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.avatar-option').classList.add('selected');
        }

        // Установка аватара
        function setAvatar() {
            if (selectedAvatar === null) return;
            
            const relative = demoRelatives.find(r => r.id === currentRelativeId);
            if (!relative) return;
            
            // Обновление аватара в чате
            const avatarElement = document.getElementById('currentAvatar');
            if (selectedAvatar) {
                avatarElement.innerHTML = `<img src="${selectedAvatar}" alt="${relative.name}">`;
            } else {
                avatarElement.innerHTML = relative.avatarInitial;
                avatarElement.style.background = relative.avatarColor;
            }
            
            // Обновление аватара в списке
            const relativeItem = document.querySelector(`.relative-item.active .relative-avatar`);
            if (relativeItem) {
                if (selectedAvatar) {
                    relativeItem.innerHTML = `<img src="${selectedAvatar}" alt="${relative.name}">`;
                } else {
                    relativeItem.innerHTML = relative.avatarInitial;
                }
            }
            
            closeAvatarModal();
            showNotification('Аватар обновлён', `Аватар для ${relative.name} установлен`);
            playNotificationSound();
        }

        // Сохранение родственника
        function saveRelative() {
            const name = document.getElementById('relativeName').value.trim();
            const relationship = document.getElementById('relativeRelationship').value.trim();
            
            if (!name || !relationship) {
                showNotification('Ошибка', 'Заполните обязательные поля');
                return;
            }
            
            // Генерация случайного цвета для аватара
            const colors = ['#8a5cf5', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#6366f1'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            const newRelative = {
                id: demoRelatives.length + 1,
                name: name,
                relationship: relationship,
                avatarColor: randomColor,
                avatarInitial: name.charAt(0).toUpperCase(),
                birthDate: document.getElementById('relativeBirthDate').value,
                speech: document.getElementById('relativeSpeech').value,
                bio: document.getElementById('relativeBio').value,
                status: 'ready',
                messages: [
                    {
                        text: `Привет, я ${name}. Спасибо, что сохраняешь память обо мне.`,
                        sender: 'ai',
                        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                    }
                ],
                photos: [],
                personality: {
                    active: true,
                    topics: ["семья", "воспоминания", "советы"],
                    askQuestions: true,
                    initiateConversation: true
                }
            };
            
            demoRelatives.push(newRelative);
            loadRelatives();
            closeAddRelativeModal();
            
            // Очистка формы
            document.getElementById('relativeName').value = '';
            document.getElementById('relativeRelationship').value = '';
            document.getElementById('relativeBirthDate').value = '';
            document.getElementById('relativeSpeech').value = '';
            document.getElementById('relativeBio').value = '';
            
            showNotification('Успешно', `Профиль ${name} создан`);
            playNotificationSound();
            
            // Переключение на нового родственника
            setTimeout(() => switchRelative(newRelative.id), 500);
        }

        // Экспорт беседы
        function exportConversation() {
            if (!currentRelativeId) {
                showNotification('Ошибка', 'Сначала выберите диалог');
                return;
            }
            
            const relative = demoRelatives.find(r => r.id === currentRelativeId);
            const data = {
                relative: {
                    name: relative.name,
                    relationship: relative.relationship
                },
                messages: relative.messages,
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `afterlife-call-${relative.name.toLowerCase()}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Экспорт завершён', `Диалог с ${relative.name} сохранён`);
            playNotificationSound();
        }

        // Утилиты
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
    </script>
</body>
</html>
